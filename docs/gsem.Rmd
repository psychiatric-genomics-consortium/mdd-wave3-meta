---
title: Structure Meta-Analysis with GenomicSEM
output: github_document
---

Summary statistics were grouped based on phenotype, then meta-analysed:

- `clin`: Clinical assessment
- `ehr`: Electronic health records
- `quest`: Questionnaire
- `self`: Single-item self report

The LDSC covariance structure of the four MDD phenotype was calcuted using [GenomicSEM](https://github.com/GenomicSEM/GenomicSEM).

```{r}

library(GenomicSEM)
library(readr)
library(corrplot)

```

Read in the covariance structure and the LDSC 

```{r covstruct}

mdd_covstruct <- dget(snakemake@input$covstruct)

```

LDSC statistics

```{r ldsc}
ldsc_table <- read_tsv(snakemake@input$ldsc_table)
knitr::kable(ldsc_table)
```

Genetic correlations

```{r rg, results='hide'}

corrplot(cov2cor(mdd_covstruct$S), method='number')

```

Common factor model

```{r model}

common.model <- "A =~ NA*clin + ehr + quest + self
A ~~ 1*A"

common.fit <- usermodel(covstruc=mdd_covstruct, estimation='DWLS', model=common.model)

```

```{r fit}

knitr::kable(common.fit$modelfit)

```

```{r results}


common.fit$results$Unstand_SE <- as.numeric(common.fit$results$Unstand_SE)
common.fit$results$STD_Genotype_SE <- as.numeric(common.fit$results$STD_Genotype_SE)

knitr::kable(common.fit$results, digits=4)

```